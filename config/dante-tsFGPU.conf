# Dante SOCKS5 server configuration for namespace proxy
#
# CUSTOMIZE:
#   <VETH_NS_IP>: Namespace veth IP (default: 10.200.0.6)
#   <SOCKS_PORT>: SOCKS5 port (default: 11080)
# Filename should match: dante-<NAMESPACE>.conf
#
# This configuration:
#   - Listens on the namespace's veth IP (reachable from host)
#   - Routes outbound traffic through the namespace's tailscale0 interface
#   - Supports SOCKS5 hostname resolution (DOMAINNAME address type)
#   - Requires username/password authentication (SOCKS5 RFC 1929)
#
# SETUP: Create a system user for proxy authentication:
#   sudo useradd -r -s /usr/sbin/nologin proxyuser
#   sudo passwd proxyuser

logoutput: syslog

# Listen on the namespace veth IP
internal: <VETH_NS_IP> port = <SOCKS_PORT>

# Use the tailscale interface for outbound connections
external: tailscale0

# Require SOCKS5 username/password authentication (uses system PAM)
clientmethod: none
socksmethod: username

client pass {
    from: 10.200.0.0/24 to: 0.0.0.0/0
    log: connect disconnect error
}

socks pass {
    from: 10.200.0.0/24 to: 0.0.0.0/0
    command: connect
    log: connect disconnect error
}
